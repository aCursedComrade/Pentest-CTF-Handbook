#Phases/Methodology #Post-Exploitation 

Pivoting simply means being able to jump/communicate to another network that is not directly accessible by us (the attacker). Pivoting is possible on dual-homed victim machines (connected to 2 or more networks).

Pivoting is done by opening up a route to the remote network via the dual-homed victim machine. Once a route is open, we can scan/run attacks against the remote network and the machines on that network depending on our situation.

- [Pivoting techniques - PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Network%20Pivoting%20Techniques.md)

***

Two main methods used for pivoting:
 - **Tunneling/Proxy** : Creating a proxy type connection through a compromised machine in order to route all desired traffic into the targeted network. This could potentially also be _tunneled_ inside another protocol (e.g. SSH tunneling), which can be useful for evading a basic **I**ntrusion **D**etection **S**ystem (**IDS**) or firewall. A proxy is good if we want to redirect lots of different kinds of traffic into our target network -- for example, with an nmap scan, or to access multiple ports on multiple different machines.
 - **Port Forwarding** : Creating a connection between a local port and a single port on a target, via a compromised host. Tends to be faster and more reliable, but only allows us to access a single port (or a small range) on a target device.

> Which style of pivoting is more suitable will depend entirely on the layout of the network, so we'll have to start with further enumeration before we decide how to proceed. It would be sensible at this point to also start to draw up a layout of the network as you see it.

> As a general rule, if you have multiple possible entry-points, try to use a Linux/Unix target where possible, as these tend to be easier to pivot from. An outward facing Linux webserver is absolutely ideal.

### Network Enumeration
There are five possible ways to enumerate a network through a compromised host:

1.  Using material found on the machine. The hosts file or ARP cache, for example
2.  Using pre-installed tools
3.  Using statically compiled tools
4.  Using scripting techniques
5.  Using local tools through a proxy

`arp -a` can be used to Windows or Linux to check the ARP cache of the machine -- this will show you any IP addresses of hosts that the target has interacted with recently. Equally, static mappings may be found in `/etc/hosts` on Linux, or `C:\Windows\System32\drivers\etc\hosts` on Windows. `/etc/resolv.conf` on Linux may also identify any local DNS servers, which may be misconfigured to allow something like a DNS zone transfer attack (which is outwith the scope of this content, but worth looking into). On Windows the easiest way to check the DNS servers for an interface is with `ipconfig /all`. Linux has an equivalent command as an alternative to reading the resolv.conf file: `nmcli dev show`.

If there are no useful tools available on the machine, It is possible to use static copies of certain tools which can be found on the internet, such as listed [here](https://github.com/andrew-d/static-binaries). They may act/use different syntax compared to their original counterpart.

Scanning through proxies should be considered as an absolute last resort as it can be *very slow*. Use the compromised target to identify entry points on the internal network first and then use your local tools against *discovered* entry points.

### Useful `bash` one-liners:
 - `for i in {1..255}; do (ping -c 1 192.168.1.${i} | grep "bytes from" &); done` - executes a full ping sweep on a given network (modify values accordingly)
 - `for i in {1..65535}; do (echo > /dev/tcp/192.168.1.1/$i) >/dev/null 2>&1 && echo $i is open; done` - executes a port scan on a given host (modify values accordingly, *long* execution time)

### Tools of Interest
 - Proxychains & FoxyProxy - can be used to access a proxy created with one of the other tools
 - SSH Tunneling/Port Forwarding - can be used to create both port forwards, and proxies
 - plink.exe - an SSH client for Windows, allowing you to create reverse SSH connections on Windows
 - Socat - a good option for redirecting connections, and can be used to create port forwards in a variety of different ways
 - Chisel - can do the exact same thing as with SSH portforwarding/tunneling, but doesn't require SSH access on the box
 - sshuttle - a nicer way to create a proxy when we have SSH access on a target (like a VPN)

> On fully compromised targets, it is possible to create a route to the inaccessible network with iptables/firewall rules natively without ever having to use other tools.

